---
// src/pages/posts/[slug].astro
import "../../styles/global.css";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { fetchPosts, decodeHTMLEntities } from "../../scripts/scripts.js";

// This is required for dynamic routes in Astro
export async function getStaticPaths() {
  const posts = await fetchPosts();
  //@ts-ignore
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

// Get the post directly from props since we're now passing the complete post object
const { post } = Astro.props;
---

<html>
  <head>
    <link rel="icon" type="image/svg+xml" href="/f1.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8">
    <meta name="description" content="A blog about Formula 1.">
    <meta name="keywords" content="Formula 1, Blog, F1, OnBoard">
    <meta name="author" content="00chestnut">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="OnBoard - Formula1">
    <meta property="og:description" content="A blog about Formula 1.">
    <!--@ts-ignore -->
    <title>{decodeHTMLEntities(post.title)} - OnBoard Formula 1</title>
  </head>
  <body>
    <container>
      <Header />
      <main class="max-w-4xl mx-auto px-4 py-8 mb-[30rem]">
        <article class="bg-white rounded-lg shadow-md overflow-hidden pb-2">
          <!--@ts-ignore -->
          <img 
            src={post.imageUrl}
            alt={decodeHTMLEntities(post.title)}
            class="w-full aspect-[16/9] md:h-[500px] object-cover object-bottom"
          />
          <!--Image above title (could be replaced in the future with a local banner!) -->

          <div class="p-6">
            <h1 class="text-3xl font-bold mb-2">
              <!--@ts-ignore -->
              {decodeHTMLEntities(post.title)}
            </h1><!--@ts-ignore -->
            <div class="text-gray-500 mb-4">Published on {post.date}</div>
            <!--@ts-ignore -->
            <div class="Content prose max-w-none preserve-whitespace" set:html={post.content} />
          </div>
        </article>
        <!-- Back to all posts link -->
        <div class="mt-6">
          <a 
            href="/page/1" 
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-red-700 rounded-lg hover:bg-red-800"
          >
            <svg 
              class="w-3.5 h-3.5 mr-2 rotate-180" 
              aria-hidden="true" 
              xmlns="http://www.w3.org/2000/svg" 
              fill="none" 
              viewBox="0 0 14 10"
            >
              <path 
                stroke="currentColor" 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                stroke-width="2" 
                d="M1 5h12m0 0L9 1m4 4L9 9"
              ></path>
            </svg>
            Back to all posts
          </a>
        </div>
        <!--@ts-ignore -->
        <div class="Tags text-gray-300 text-xs object-bottom" set:html={post.tags}>
          <h6>Tags:</h6>
        </div>
      </main>
      <Footer />
    </container>
  </body>
</html>


<style is:global>
  .Tags{
    gap:20px;
  }
  .Content{
    line-height: 1.6;
  }
  .Content h1{
    font-size: 2rem;
  }
  .Content h2{
    font-size: 1.5rem;
  }
  .Content h3{
    font-size: 1.25rem;
  }
  .preserve-whitespace p {
    white-space: pre-line;
    margin-bottom: 1rem;
  }
  .preserve-whitespace br {
    display: block;
    content: "";
    margin-top: 1rem;
  }
</style>